<!DOCTYPE html>
<html lang={assigns[:locale] || "en"}>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <meta name="csrf-token" content={get_csrf_token()} />

    <%!-- PWA Meta Tags --%>
    <link rel="manifest" href="/manifest.json" crossorigin="use-credentials" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="SahajYog" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="apple-touch-icon" href="/images/logo-192-actual.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/images/logo-192-actual.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/images/logo-512.png" />

    <.live_title suffix=" Â· SahajYog">
      {assigns[:page_title] || "SahajYog"}
    </.live_title>
    <%!-- Google Fonts: Playfair Display for headings/quotes, Inter for body --%>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&display=swap"
      rel="stylesheet"
    />
    <link phx-track-static rel="stylesheet" href={~p"/assets/css/app.css"} />
    <script defer phx-track-static type="text/javascript" src={~p"/assets/js/app.js"}>
    </script>
  </head>
  <body class="overflow-x-clip bg-base-300">
    <div class="sticky top-0 w-full z-[40] bg-base-100/95 backdrop-blur-sm border-b border-base-content/10 shadow-sm">
      <div class="max-w-7xl mx-auto flex items-center justify-between gap-2 sm:gap-4 px-3 sm:px-6 lg:px-8 py-2">
        <%!-- Left Section - Home Icon --%>
        <div class="flex items-center shrink-0">
          <%!-- Brand Logo --%>
          <a
            href="/"
            class="flex items-center transition-all hover:opacity-80 active:scale-95 home-icon focus:outline-none focus:ring-2 focus:ring-primary rounded-full relative"
            title="Home"
          >
            <div class="relative rounded-full ring-1 ring-base-content/20 shadow-lg overflow-hidden group-hover:ring-primary/50 transition-all">
              <img
                src={~p"/images/logo-192-actual.png"}
                alt="SahajYog"
                class="w-10 h-10 2xl:w-12 2xl:h-12 object-cover"
              />
            </div>
          </a>
        </div>

        <%!-- Desktop Navigation --%>
        <div class="hidden lg:flex items-center text-base-content shrink-0 px-2">
          <%!-- Main Links Group --%>
          <div class="flex items-center gap-1 xl:gap-2 2xl:text-lg mr-2 xl:mr-4">
            <.link
              href={~p"/talks"}
              data-nav-path="/talks"
              class="nav-link px-3 py-2 rounded-lg font-medium hover:bg-base-200 transition-all flex items-center justify-center min-h-[44px]"
            >
              {gettext("Talks")}
            </.link>

            <%= if assigns[:current_scope] do %>
              <.link
                href={~p"/steps"}
                data-nav-path="/steps"
                class="nav-link px-3 py-2 rounded-lg font-medium hover:bg-base-200 transition-all flex items-center justify-center min-h-[44px]"
              >
                {gettext("Steps")}
              </.link>

              <.link
                href={~p"/topics"}
                data-nav-path="/topics"
                class="nav-link px-3 py-2 rounded-lg font-medium hover:bg-base-200 transition-all flex items-center justify-center min-h-[44px]"
              >
                {gettext("Topics")}
              </.link>

              <.link
                href={~p"/resources"}
                data-nav-path="/resources"
                class="nav-link px-3 py-2 rounded-lg font-medium hover:bg-base-200 transition-all flex items-center justify-center min-h-[44px]"
              >
                {gettext("Resources")}
              </.link>

              <%= if Sahajyog.Accounts.User.can_access_events?(@current_scope.user) do %>
                <.link
                  href={~p"/events"}
                  data-nav-path="/events"
                  class="nav-link px-3 py-2 rounded-lg font-medium hover:bg-base-200 transition-all flex items-center justify-center min-h-[44px]"
                >
                  {gettext("Events")}
                </.link>
              <% end %>

              <.link
                href={~p"/store"}
                data-nav-path="/store"
                class="nav-link px-3 py-2 rounded-lg font-medium hover:bg-base-200 transition-all flex items-center justify-center min-h-[44px]"
              >
                {gettext("Store")}
              </.link>

              <%= if Sahajyog.Accounts.User.admin?(@current_scope.user) do %>
                <.link
                  href={~p"/admin/videos"}
                  data-nav-path="/admin"
                  class="nav-link px-3 py-2 rounded-lg font-medium hover:bg-base-200 transition-all flex items-center justify-center min-h-[44px]"
                >
                  {gettext("Admin")}
                </.link>
              <% end %>
            <% end %>
          </div>

          <%!-- Action Items Group (Locale, Theme, Avatar) --%>
          <div class="flex items-center gap-2 xl:gap-3 border-l border-base-content/10 pl-4 ml-2 xl:ml-4">
            <.locale_switcher
              id="locale-select-desktop"
              current_locale={assigns[:locale] || "en"}
            />
            <.theme_toggle />

            <%= if assigns[:current_scope] do %>
              <%!-- User Avatar Dropdown --%>
              <div class="dropdown dropdown-end flex items-center">
                <div
                  tabindex="0"
                  role="button"
                  class="flex items-center justify-center w-10 h-10 rounded-full bg-base-100 text-base-content font-semibold cursor-pointer hover:bg-base-200 transition-all focus:outline-none focus:ring-2 focus:ring-primary shadow-sm"
                  title={@current_scope.user.email}
                >
                  {String.upcase(String.first(@current_scope.user.email))}
                </div>
                <ul
                  tabindex="0"
                  class="dropdown-content menu bg-base-200 rounded-box z-[99999] w-64 p-2 shadow-xl mt-4 border border-base-content/10"
                >
                  <li class="border-b border-base-300 mb-1">
                    <div class="flex items-center gap-3 px-3 py-2 pointer-events-none">
                      <div class="flex items-center justify-center w-10 h-10 rounded-full bg-primary/10 text-primary font-bold">
                        {String.upcase(String.first(@current_scope.user.email))}
                      </div>
                      <div class="flex-1 min-w-0">
                        <p class="text-xs text-base-content/50 uppercase font-bold tracking-wider mb-0.5">
                          Account
                        </p>
                        <p class="text-sm font-semibold truncate leading-none text-base-content">
                          {@current_scope.user.email}
                        </p>
                      </div>
                    </div>
                  </li>
                  <li>
                    <.link
                      href={~p"/users/settings"}
                      class="flex items-center gap-2 py-3 px-4 rounded-lg hover:bg-primary/10 hover:text-primary transition-colors"
                    >
                      <.icon name="hero-cog-6-tooth" class="w-5 h-5" />
                      <span>{gettext("Account settings")}</span>
                    </.link>
                  </li>
                  <li :if={Sahajyog.Accounts.User.eligible_for_upgrade?(@current_scope.user)}>
                    <.link
                      href={~p"/level-upgrade"}
                      class="flex items-center gap-2 py-3 px-4 rounded-lg hover:bg-primary/10 hover:text-primary transition-colors"
                    >
                      <.icon name="hero-arrow-up-circle" class="w-5 h-5" />
                      <span>{gettext("Upgrade Access")}</span>
                    </.link>
                  </li>
                  <li class="border-t border-base-300 mt-2 pt-2">
                    <.link
                      href={~p"/users/log-out"}
                      method="delete"
                      class="flex items-center gap-2 py-3 px-4 rounded-lg hover:bg-error/10 hover:text-error transition-colors text-error"
                    >
                      <.icon name="hero-arrow-right-on-rectangle" class="w-5 h-5" />
                      <span>{gettext("Sign out")}</span>
                    </.link>
                  </li>
                </ul>
              </div>
            <% else %>
              <div class="flex items-center gap-2 ml-2">
                <.link
                  href={~p"/users/register"}
                  class="btn btn-primary btn-sm rounded-lg font-semibold px-4 h-10"
                >
                  {gettext("Register")}
                </.link>
                <.link
                  href={~p"/users/log-in"}
                  class="btn btn-ghost btn-sm rounded-lg font-medium px-4 h-10 hover:bg-base-200 transition-colors"
                >
                  {gettext("Log in")}
                </.link>
              </div>
            <% end %>
          </div>
        </div>
        <%!-- Mobile Hamburger Button (Drawer Toggle) --%>
        <label
          for="mobile-drawer"
          class="lg:hidden btn btn-ghost btn-circle"
          aria-label="Toggle menu"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"
            />
          </svg>
        </label>
      </div>
    </div>
    <div class="drawer drawer-end">
      <input id="mobile-drawer" type="checkbox" class="drawer-toggle" />
      <div class="drawer-content flex flex-col min-h-screen">
        {@inner_content}
        <Layouts.footer current_scope={assigns[:current_scope]} />
      </div>
      <%!-- Mobile Drawer Side --%>
      <div class="drawer-side z-[9999] lg:hidden">
        <label for="mobile-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
        <.mobile_menu current_scope={assigns[:current_scope]} locale={assigns[:locale] || "en"} />
      </div>
    </div>
  </body>
</html>
